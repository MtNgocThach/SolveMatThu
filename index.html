<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Giải Mật Thư</title>
</head>
<body>
    <!-- A = D: QER – ALKG – IBBRC.-->
    <!-- C = R: E S T P F – Y S T -->
    <!-- I = 1: 21 26 13 19 11- 20 19 - 6 25 7 7 1 -->
    <div class="conten m-3">
        <div class="form-row">
            <div class="col"></div>
            <div class="col ml-5">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active js-choose-type" id="char_char-tab" data-req='3' data-toggle="tab" href="#char_char" role="tab" aria-controls="char_char" aria-selected="true">Chữ - Chữ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link js-choose-type" id="char_numb-tab" data-req='4' data-toggle="tab" href="#char_numb" role="tab" aria-controls="char_numb" aria-selected="false">Chữ - Số</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="form-row">
            <label for="keys">Khoá</label>
            <div class="col">
                <input type="text" class="form-control" id="key">
            </div>
            <div class="equal-character">
                <span>=</span>
            </div>
            <div class="col ml-2">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="char_char" role="tabpanel" aria-labelledby="char_char-tab">
                        <input type="text" class="form-control" maxlength="1" id="keyCompareChar">
                    </div>
                    <div class="tab-pane fade" id="char_numb" role="tabpanel" aria-labelledby="char_numb-tab">
                        <input type="number" class="form-control" id="keyCompareNumb">
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="secretString">Bạch Văn</label>
            <input type="text" class="form-control" id="secretString" placeholder="Fill in the secret text">
        </div>

        <div class="row text-center">
            <div class="col">
                <button type="button" class="btn btn-success" id="submit">Giải Mã</button>
            </div>
            <div class="col">
                <button type="button" class="btn btn-danger" id="encoding">Mã Hoá</button>
            </div>
        </div>
        <div class="form-group mt-5">
            <label for="stringDecoding">Đoạn Giải Mã</label>
            <input type="text" class="form-control" id="stringDecoding" disabled>
        </div>

        <div class="form-group">
            <label for="stringEncoding">Đoạn Mã Hoá</label>
            <input type="text" class="form-control" id="stringEncoding" disabled>
        </div>
    </div>
</body>
</html>

<script>
    const TYPE = { DECONDING: 1, ENCONDING: 2, CHAR: 3, NUMBER: 4 };
    const COMPARE_DATA = { A: 'A', Z: 'Z', 'NUMBER': 26, REGEX: /\W/};

    $('#secretString').keypress(function(event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            solveStringSecret({type: TYPE.DECONDING});
        }
    });

    $('#submit').click(function(event) {
        solveStringSecret({type: TYPE.DECONDING});
    });

    $('#encoding').click(function(event) {
        solveStringSecret({type: TYPE.ENCONDING});
    });

    $('.js-choose-type').click(function(event) {
        typeRequest = $(this).data('req');
    });

    var typeRequest = TYPE.CHAR;

    function generaArrayChar(startInt, endInt) {
        var arrayCharter = [];

        for (let i = startInt; i <= endInt; ++i) {
            arrayCharter.push(String.fromCharCode(i));
        }

        return arrayCharter;
    }

    function generaArrayNumb(startInt, endInt) {
        var arrayNumber = [];

        for (let i = startInt; i <= endInt; i++) {
            arrayNumber.push(i);
        }

        return arrayNumber;
    }

    function getValueCommon(arrayCompare, arrayCharter, charSecret, type) {
        var charIndex;
        const isLargeNumber = (element) => element == charSecret;

        if (COMPARE_DATA.REGEX.test(charSecret)) {
            return charSecret;
        }
        if (type === TYPE.DECONDING) {
            charIndex = arrayCompare.findIndex(isLargeNumber);
            return arrayCharter[charIndex];
        } else {
            charIndex = arrayCharter.findIndex(isLargeNumber);
            return arrayCompare[charIndex];
        }
    }

    function compareValueNumbers(args) {
        var result = '';
        var arrayCharter = buildArrayCharter(args.key);
        var arrayCompare = buildArrayNumber(args.keyCompare);
        var stringArr = args.secretString.split(COMPARE_DATA.REGEX);

        if (args.type === TYPE.ENCONDING) {
            for (let index = 0; index < args.secretString.length; index++) {
                var char = getValueCommon(arrayCompare, arrayCharter, args.secretString[index], args.type);
                if (char === undefined) {return ''};
                result += char + ' ';
            }
        } else {
            for (let index = 0; index < stringArr.length; index++) {
                if (stringArr[index]) {
                    var char = getValueCommon(arrayCompare, arrayCharter, stringArr[index], args.type) + ' ';
                    if (char === undefined) {return ''};
                    result += char + ' ';
                }
            }
        }

        return result;
    }

    function compareValueCharacters(args) {
        var result = '';
        var arrayCompare = buildArrayCharter(args.key);
        var arrayCharter = buildArrayCharter(args.keyCompare);

        for (let index = 0; index < args.secretString.length; index++) {
            result += getValueCommon(arrayCompare, arrayCharter, args.secretString[index], args.type);
        }

        return result;
    }

    function buildArrayNumber(key) {
        var keyEnd = COMPARE_DATA.NUMBER;

        if (key !== 1) {
            result = generaArrayNumb(key, keyEnd);
            result = result.concat(generaArrayNumb(1, key - 1));
        } else {
            result = generaArrayNumb(1, keyEnd);
        }

        return result;
    }
    
    function buildArrayCharter(key) {
        var result = [];
        var keyEnd = COMPARE_DATA.Z;

        if (COMPARE_DATA.A.charCodeAt(0) !== key.charCodeAt(0)) {
            result = generaArrayChar(key.charCodeAt(0), keyEnd.charCodeAt(0));
            result = result.concat(generaArrayChar(COMPARE_DATA.A.charCodeAt(0), key.charCodeAt(0) - 1));
        } else {
            result = generaArrayChar(COMPARE_DATA.A.charCodeAt(0), keyEnd.charCodeAt(0));
        }

        return result;
    }

    function solveStringSecret(params) {
        var result = '';
        var keyCompare = '';
        var key = $('#key').val().toUpperCase();
        var secretString = $('#secretString').val().trim().toUpperCase();
        var keyCompareChar = $('#keyCompareChar').val().trim().toUpperCase();
        var keyCompareNumb = $('#keyCompareNumb').val().trim().toUpperCase();
        keyCompare = keyCompareChar || (keyCompareNumb ? parseInt(keyCompareNumb) : null);

        if (!key || !keyCompare || !secretString) {
            alert('Please enter secret key blocks and string!')
            return;
        }

        var args = { key: key, type: params.type, keyCompare: keyCompare, secretString: secretString }
        if (typeRequest === TYPE.NUMBER) {
            result = compareValueNumbers(args);
        } else {
            result = compareValueCharacters(args);
        }
        
        result = result === undefined ? null : result;

        if (params.type === TYPE.DECONDING) {
            $('#stringDecoding').val(result.trim());
        } else {
            $('#stringEncoding').val(result.trim());
        }
    }
</script>